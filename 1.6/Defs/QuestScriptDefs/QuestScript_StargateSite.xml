<?xml version="1.0" encoding="utf-8"?>
<Defs>

	<QuestScriptDef>
		<defName>Rimgate_StargateSiteScript</defName>
		<rootSelectionWeight>0.6</rootSelectionWeight>
		<rootMinPoints>0</rootMinPoints>
		<autoAccept>true</autoAccept>
		<defaultChallengeRating>1</defaultChallengeRating>
		<questNameRules>
			<rulesStrings>
				<li>questName->[adj] stargate [site]</li>
				<li>adj->Ancient</li>
				<li>adj->Old</li>
				<li>adj->Abandoned</li>
				<li>adj->Forgotten</li>
				<li>site->site</li>
				<li>site->complex</li>
				<li>site->spot</li>
				<li>site->place</li>
				<li>site->location</li>
				<li>site->plot</li>
				<li>site->point</li>
			</rulesStrings>
		</questNameRules>
		<questDescriptionRules>
			<rulesStrings>
				<li>questDescription(askerIsNull==true)->We have identified the location of an ancient structure housing what appears to be a dormant stargate.\n\nWhether it’s a forgotten relic, a trap, or the galaxy’s worst Airbnb, it’s worth checking out. Bring weapons—and a good translator.</li>
			</rulesStrings>
		</questDescriptionRules>
		<root Class="QuestNode_Sequence">
			<nodes>
				<li Class="QuestNode_SubScript">
					<def>Util_GetDefaultRewardValueFromPoints</def>
				</li>

				<li Class="QuestNode_GetMap" />

				<li Class="QuestNode_IsSet">
					<name>asker</name>
					<elseNode Class="QuestNode_RandomNode">
						<nodes>
							<li Class="QuestNode_Set">
								<name>askerIsNull</name>
								<value>true</value>
								<selectionWeight>0.4</selectionWeight>
							</li>
						</nodes>
					</elseNode>
				</li>

				<li Class="QuestNode_GetSiteTile">
					<storeAs>siteTile</storeAs>
					<preferCloserTiles>false</preferCloserTiles>
				</li>

				<li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
					<storeAs>sitePartDefs</storeAs>
					<storeFactionAs>siteFaction</storeFactionAs>
					<sitePartsTags>
						<li>
							<tag>Rimgate_StargateSite</tag>
						</li>
						<li>
							<tag>Rimgate_StargateTrapSite</tag>
							<chance>0.1</chance>
						</li>
						<li>
							<tag>KCSG_EnnemiesPresence</tag>
						</li>
					</sitePartsTags>
				</li>

				<li Class="QuestNode_GetDefaultSitePartsParams">
					<tile>$siteTile</tile>
					<faction>$siteFaction</faction>
					<sitePartDefs>$sitePartDefs</sitePartDefs>
					<storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
				</li>

				<li Class="QuestNode_SubScript">
					<def>Util_GenerateSite</def>
					<parms>
						<hiddenSitePartsPossible>true</hiddenSitePartsPossible>
					</parms>
				</li>

				<li Class="QuestNode_SpawnWorldObjects">
					<worldObjects>$site</worldObjects>
				</li>

				<li Class="Rimgate.QuestNode_AddStargateAddresses">
					<address>$site</address>
					<remove>false</remove>
				</li>

				<li Class="Rimgate.QuestNode_RaidStargateComplex">
					<address>$site</address>
					<excludeTags>
						<li>Rimgate_StargateTrapSite</li>
					</excludeTags>
				</li>

				<li Class="QuestNode_WorldObjectTimeout">
					<worldObject>$site</worldObject>
					<isQuestTimeout>true</isQuestTimeout>
					<delayTicks>1800000</delayTicks>
					<inSignalDisable>site.MapGenerated</inSignalDisable>
					<node Class="QuestNode_Sequence">
						<nodes>
							<li Class="QuestNode_Letter">
								<label>Quest expired: [resolvedQuestName]</label>
								<text>By the time you mobilized, others had already stripped the site bare.\n\nThe stargate is gone, the tech looted, and the opportunity lost.\n\nNext time, bring snacks and move faster.</text>
							</li>

							<li Class="QuestNode_End">
								<outcome>Fail</outcome>
							</li>
						</nodes>
					</node>
				</li>

				<li Class="QuestNode_NoWorldObject">
					<worldObject>$site</worldObject>
					<node Class="QuestNode_End" />
				</li>
			</nodes>
		</root>
	</QuestScriptDef>

</Defs>