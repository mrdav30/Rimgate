<?xml version="1.0" encoding="utf-8"?>
<Defs>

	<QuestScriptDef>
		<defName>Rimgate_StargateSiteWraithScript</defName>
		<rootSelectionWeight>0.6</rootSelectionWeight>
		<rootMinPoints>0</rootMinPoints>
		<autoAccept>true</autoAccept>
		<defaultChallengeRating>2</defaultChallengeRating>
		<questNameRules>
			<rulesStrings>
				<li>questName->[adj] stargate [site]</li>
				<li>adj->Ancient</li>
				<li>adj->Forgotten</li>
				<li>adj->Shrouded</li>
				<li>site->nest</li>
				<li>site->complex</li>
				<li>site->hollow</li>
			</rulesStrings>
		</questNameRules>
		<questDescriptionRules>
			<rulesStrings>
				<li>questDescription(askerIsNull==true)->The glyphs describe a structure surrounding a dormant stargate.\n\nIt hums faintly with a resonance you can almost feel in your skull. Whether it is an abandoned lair, or something still stirring within, is impossible to tell from here.\n\nIt’s worth investigating, but be prepared for anything.</li>
			</rulesStrings>
		</questDescriptionRules>
		<root Class="QuestNode_Sequence">
			<nodes>
				<li Class="QuestNode_SubScript">
					<def>Util_GetDefaultRewardValueFromPoints</def>
				</li>

				<li Class="QuestNode_GetMap" />

				<li Class="QuestNode_IsSet">
					<name>asker</name>
					<elseNode Class="QuestNode_RandomNode">
						<nodes>
							<li Class="QuestNode_Set">
								<name>askerIsNull</name>
								<value>true</value>
								<selectionWeight>0.4</selectionWeight>
							</li>
						</nodes>
					</elseNode>
				</li>

				<li Class="QuestNode_GetSiteTile">
					<storeAs>siteTile</storeAs>
					<preferCloserTiles>false</preferCloserTiles>
				</li>

				<li Class="Rimgate.QuestNode_GetFactionOfDef">
					<factionDef>Rimgate_WraithEmpire</factionDef>
					<storeAs>enemyFaction</storeAs>
				</li>

				<li Class="QuestNode_GetSitePartDefsByTagsAndFaction">
					<storeAs>sitePartDefs</storeAs>
					<storeFactionAs>siteFaction</storeFactionAs>
					<sitePartsTags>
						<li>
							<tag>Rimgate_StargateSiteWraith</tag>
						</li>
						<li>
							<tag>Rimgate_SoldierWraith</tag>
						</li>
					</sitePartsTags>
				</li>

				<li Class="QuestNode_GetDefaultSitePartsParams">
					<tile>$siteTile</tile>
					<faction>$siteFaction</faction>
					<sitePartDefs>$sitePartDefs</sitePartDefs>
					<storeSitePartsParamsAs>sitePartsParams</storeSitePartsParamsAs>
				</li>

				<li Class="QuestNode_SubScript">
					<def>Util_GenerateStargateSite</def>
					<parms>
						<hiddenSitePartsPossible>true</hiddenSitePartsPossible>
					</parms>
				</li>

				<li Class="QuestNode_SpawnWorldObjects">
					<worldObjects>$site</worldObjects>
				</li>

				<li Class="Rimgate.QuestNode_RaidStargateComplex">
					<address>$site</address>
				</li>

				<li Class="QuestNode_WorldObjectTimeout">
					<worldObject>$site</worldObject>
					<isQuestTimeout>true</isQuestTimeout>
					<delayTicks>900000</delayTicks>
					<node Class="QuestNode_Sequence">
						<nodes>
							<li Class="QuestNode_Letter">
								<label>Quest expired: [resolvedQuestName]</label>
								<text>Only echoes remained. The stargate is gone, stripped by unseen hands. The resonance lingers, leaving your crew uneasy. Some things are best left forgotten.</text>
							</li>

							<li Class="QuestNode_End">
								<outcome>Fail</outcome>
							</li>
						</nodes>
					</node>
				</li>

				<li Class="QuestNode_NoWorldObject">
					<worldObject>$site</worldObject>
					<node Class="QuestNode_End" />
				</li>

			</nodes>
		</root>
	</QuestScriptDef>

</Defs>